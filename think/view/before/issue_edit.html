<script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/simple-ajax-uploader/2.6.7/SimpleAjaxUploader.min.js" type="application/javascript"></script>

<div class="container pt-5">
    <div class="row pt-5">
        <div class="col">
            <div class="card">
                <div class="card-body">
                    <h3 class="text-center">提交问题</h3>
                    <form class="form1" method="post" action="">
                        <input type="hidden" name="id" value="<?=$row['id']?>">
                        <input type="hidden" name="project_id" value="<?=$project['id']?>">

                        <div class="row mb-3">
                            <label class="col-form-label col-2 pe-0">标题：</label>
                            <div class="col-10">
                                <input type="text" class="form-control" name="title" value="<?=$row['title']?>">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-form-label col-2 pe-0">内容：</label>
                            <div class="col-10">
                                <textarea class="form-control" name="content" rows="4" contenteditable="true"></textarea>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-form-label col-2 pe-0">图片附件：</label>
                            <div class="col-2">
                                <div class="border ratio ratio-1x1" id="ssUpload">
                                    <?php if($row['img_cover']):?>
                                    <img class="w-100" src="<?=imgCover($row['img_cover'])?>">
                                    <?php else:?>
                                    <div class=" d-flex align-items-center justify-content-center">
                                        <i class="far fa-plus display-4"></i>
                                    </div>
                                    <?php endif;?>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-form-label col-2 pe-0">优先级：</label>
                            <div class="col-10 d-flex align-items-center">
                                <div class="form-check d-inline-block me-3">
                                    <input class="form-check-input" type="radio" name="priority" value="1">
                                    <label class="form-check-label">
                                        紧急
                                    </label>
                                </div>
                                <div class="form-check d-inline-block me-3">
                                    <input class="form-check-input" type="radio" name="priority" value="2" checked>
                                    <label class="form-check-label">
                                        普通
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-form-label col-2 pe-0">问题类型：</label>
                            <div class="col-4">
                                <select class="form-select" name="type">
                                    <option value="<?=\app\models\Issue::DEFECT?>">缺陷</option>
                                    <option value="<?=\app\models\Issue::NEED?>">任务</option>
                                    <option value="<?=\app\models\Issue::TASK?>">需求</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-form-label col-2 pe-0">模块：</label>
                            <div class="col-4">
                                <select class="form-select" name="module_id">
                                    <?php foreach($firstModuleList as $v):?>
                                    <option value="<?=$v['id']?>"><?=$v['name']?></option>
                                    <?php foreach($v->children as $v2):?>
                                    <option value="<?=$v2['id']?>">----<?=$v2['name']?></option>
                                    <?php endforeach;?>
                                    <?php endforeach;?>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-form-label col-2 pe-0">指派人：</label>
                            <div class="col-4">
                                <select class="form-select" name="cur_user_id">
                                    <?php foreach($userList as $v):?>
                                    <option value="<?=$v['id']?>"><?=$v['username']?></option>
                                    <?php endforeach;?>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-form-label col-2 pe-0"></label>
                            <div class="col">
                                <button type="submit" class="btn btn-primary">提交</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    $(() => {
        new ss.SimpleUpload({
            button: $('#ssUpload')[0],
            name: 'file',
            url: '/common/upload',
            onComplete: function(filename, response) {
                let resp = JSON.parse(response)
                console.log(filename);
                console.log(resp);

                let h = `
                    <img  class="w-100" src="${resp.data.fullUrl}">
                    <input type="hidden" name="image" value="${resp.data.url}" />
                    <input type="hidden" name="imageUrl" value="${resp.data.fullUrl}" />
                `;
                $('#ssUpload').html(h)
            }
        })
    })
</script>